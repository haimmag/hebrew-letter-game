<html lang="he" dir="rtl">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק האותיות העבריות</title>
    <meta http-equiv="Permissions-Policy" content="microphone=*">
    <meta http-equiv="Feature-Policy" content="microphone *">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .letter-selector {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .letters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .letter-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px;
            font-size: 1.8em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .letter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .letter-btn.selected {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            transform: scale(1.1);
        }

        .game-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .word-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .word-image {
            width: 200px;
            height: 200px;
            background: #f0f0f0;
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            border: 3px solid #ddd;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .word-text {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .word-translation {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .recording-indicator {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #f44336;
            font-weight: bold;
            margin: 10px 0;
        }

        .recording-indicator.active {
            display: flex;
        }

        .pulse {
            width: 10px;
            height: 10px;
            background: #f44336;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .score {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .similarity-score {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 20px;
        }

        .position-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .position-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .position-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .next-word-btn {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
            margin: 0 auto;
            display: block;
        }

        .feedback {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
            display: none;
        }

        .feedback.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .letters-grid {
                grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
            }

            .letter-btn {
                padding: 10px;
                font-size: 1.5em;
            }

            .word-image {
                width: 150px;
                height: 150px;
                font-size: 3em;
            }

            .word-text {
                font-size: 2em;
            }
        }

        /* Voice Display Styles */
        .voices-display {
            border-radius: 5px;
            margin-top: 20px;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        .voices-list {
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .voice-item {
            background: #e9e9e9;
            padding: 5px 10px;
            border-radius: 15px;
            border: 1px solid #ccc;
            font-size: 12px;
            white-space: nowrap;
        }

        .voice-item.hebrew {
            background: #e8f5e8;
            border-color: #4caf50;
            font-weight: bold;
        }

        .words-list {
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .word-item {
            background: #e0e7ff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            border: 1px solid #c3d4ff;
        }
    </style>
</head>

<body id="artifacts-component-root-html">
    <div class="container">
        <div class="header">
            <h1>🎯 משחק האותיות העבריות</h1>
            <p>בחר אות ולמד מילים חדשות!</p>
        </div>

        <div class="letter-selector">
            <h2 style="text-align: center; margin-bottom: 20px; color: #333;">בחר אות עברית:</h2>
            <div class="letters-grid" id="lettersGrid"></div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="score" id="score">ניקוד: 0</div>
            <div class="similarity-score" id="similarityScore">דמיון: 0%</div>

            <div class="position-selector">
                <button class="position-btn active" data-position="start">התחלה</button>
                <button class="position-btn" data-position="middle">אמצע</button>
                <button class="position-btn" data-position="end">סוף</button>
            </div>

            <div class="word-display">
                <div class="word-image" id="wordImage">🎯</div>
                <div class="word-text" id="wordText">בחר אות כדי להתחיל</div>
                <div class="word-translation" id="wordTranslation"></div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="playWordBtn">🔊 השמע מילה</button>
                <button class="btn btn-danger" id="recordBtn">🎤 הקלט קולך</button>
                <button class="btn btn-success" id="playRecordingBtn" disabled="">▶️ השמע הקלטה</button>
                <button class="btn btn-info" id="analyzeSimilarityBtn" disabled="">🎯 בדוק דמיון</button>
            </div>

            <div class="recording-indicator" id="recordingIndicator">
                <div class="pulse"></div>
                <span>מקליט...</span>
            </div>

            <div class="feedback" id="feedback"></div>

            <button class="btn next-word-btn" id="nextWordBtn">➡️ מילה הבאה</button>
        </div>
    </div>

    <!-- TTS Method Selection Dropdown -->
    <div class="tts-method-selection" style="margin: 15px 0; padding: 15px; border-radius: 10px;">
        <label for="ttsMethodSelect" style="display: block; margin-bottom: 8px; font-weight: bold;">🔊 בחר שיטת
            השמעה:</label>
        <select id="ttsMethodSelect"
            style="padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; background: white;">
            <option value="playWithGoogleTTSProxy">Google TTS (דרך Proxy)</option>
            <option value="playWithLocalTTS">TTS מקומי (דפדפן)</option>
        </select>
        <div id="selectedTTSInfo" style="margin-top: 8px; font-size: 12px; color: #666; font-style: italic;">
            נבחר: Google TTS (ישיר) - זמין ברוב הדפדפנים
        </div>
    </div>

    <!-- Voice Selection Dropdown -->
    <div class="voice-selection" style="margin: 15px 0; padding: 15px;">
        <label for="voiceSelect" style="display: block; margin-bottom: 8px; font-weight: bold;">🎤
            בחר קול להשמעה:</label>
        <select id="voiceSelect"
            style="padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; background: white;">
            <option value="">טוען קולות...</option>
        </select>
        <div id="selectedVoiceInfo" style="margin-top: 8px; font-size: 12px; color: #666; font-style: italic;">
            <!-- Will show selected voice info -->
        </div>
    </div>

    <!-- Voice Display -->
    <div id="voicesDisplay" class="voices-display">
        <div class="voices-list" id="voicesList">
            <!-- Voices will be populated dynamically -->
        </div>
        <div class="words-list" id="wordsList"></div>
    </div>

    <script>
        class HebrewLetterGame {
            constructor() {
                this.selectedLetter = null;
                this.currentWord = null;
                this.currentPosition = 'start';
                this.score = 0;
                this.similarityScore = 0;
                this.mediaRecorder = null;
                this.recordedAudio = null;
                this.isRecording = false;
                this.recognizedText = '';
                this.speechRecognition = null;
                this.recordingTimeout = null;
                this.selectedVoice = null; // Track the selected voice

                this.initializeWords();
                this.initializeUI();
                this.setupEventListeners();
                this.initializeSpeechRecognition();
                this.initializeVoiceSelection(); // Initialize voice dropdown
                this.autoSelectTTSMethod(); // Auto-select TTS method based on Hebrew voice availability
            }

            initializeWords() {
                this.words = {
                    'א': {
                        start: [
                            { word: 'אבא', translation: 'אבא', emoji: '👨' },
                            { word: 'אמא', translation: 'אמא', emoji: '👩' },
                            { word: 'אוטו', translation: 'מכונית', emoji: '🚗' },
                            { word: 'אוזן', translation: 'אוזן', emoji: '👂' },
                            { word: 'אף', translation: 'אף', emoji: '👃' },
                            { word: 'אביב', translation: 'אביב', emoji: '🌸' },
                            { word: 'אדום', translation: 'אדום', emoji: '🔴' },
                            { word: 'ארנק', translation: 'ארנק', emoji: '👛' },
                            { word: 'אבן', translation: 'אבן', emoji: '🪨' },
                            { word: 'אור', translation: 'אור', emoji: '💡' }
                        ],
                        middle: [
                            { word: 'בואי', translation: 'בואי', emoji: '👋' },
                            { word: 'מאמין', translation: 'מאמין', emoji: '🙏' },
                            { word: 'ראש', translation: 'ראש', emoji: '🗣️' },
                            { word: 'שואל', translation: 'שואל', emoji: '❓' },
                            { word: 'נואש', translation: 'נואש', emoji: '😔' },
                            { word: 'מואיל', translation: 'מואיל', emoji: '✨' },
                            { word: 'בואך', translation: 'בואך', emoji: '🎯' },
                            { word: 'גאון', translation: 'גאון', emoji: '🧠' },
                            { word: 'מאוד', translation: 'מאוד', emoji: '💯' },
                            { word: 'פאר', translation: 'פאר', emoji: '👑' }
                        ],
                        end: [
                            { word: 'בבא', translation: 'בבא', emoji: '🚪' },
                            { word: 'ממא', translation: 'ממא', emoji: '💝' },
                            { word: 'סבא', translation: 'סבא', emoji: '👴' },
                            { word: 'סבתא', translation: 'סבתא', emoji: '👵' },
                            { word: 'תא', translation: 'תא', emoji: '🏠' },
                            { word: 'קרא', translation: 'קרא', emoji: '📖' },
                            { word: 'בא', translation: 'בא', emoji: '🏃' },
                            { word: 'נא', translation: 'נא', emoji: '🙏' },
                            { word: 'כלא', translation: 'כלא', emoji: '🏢' },
                            { word: 'מלא', translation: 'מלא', emoji: '🪣' }
                        ]
                    },
                    'ב': {
                        start: [
                            { word: 'בית', translation: 'בית', emoji: '🏠' },
                            { word: 'בן', translation: 'בן', emoji: '👦' },
                            { word: 'בת', translation: 'בת', emoji: '👧' },
                            { word: 'ברך', translation: 'ברך', emoji: '🦵' },
                            { word: 'בטן', translation: 'בטן', emoji: '🤰' },
                            { word: 'ביצה', translation: 'ביצה', emoji: '🥚' },
                            { word: 'בננה', translation: 'בננה', emoji: '🍌' },
                            { word: 'ברזל', translation: 'ברזל', emoji: '🔩' },
                            { word: 'בגד', translation: 'בגד', emoji: '👕' },
                            { word: 'בובה', translation: 'בובה', emoji: '🪆' }
                        ],
                        middle: [
                            { word: 'חבר', translation: 'חבר', emoji: '👫' },
                            { word: 'שבת', translation: 'שבת', emoji: '🕯️' },
                            { word: 'אבא', translation: 'אבא', emoji: '👨' },
                            { word: 'זבוב', translation: 'זבוב', emoji: '🪰' },
                            { word: 'עב', translation: 'עב', emoji: '☁️' },
                            { word: 'כבש', translation: 'כבש', emoji: '🐑' },
                            { word: 'דבש', translation: 'דבש', emoji: '🍯' },
                            { word: 'גבר', translation: 'גבר', emoji: '👨' },
                            { word: 'שבע', translation: 'שבע', emoji: '7️⃣' },
                            { word: 'לבן', translation: 'לבן', emoji: '⚪' }
                        ],
                        end: [
                            { word: 'לב', translation: 'לב', emoji: '❤️' },
                            { word: 'זהב', translation: 'זהב', emoji: '🥇' },
                            { word: 'זיתון', translation: 'זיתון', emoji: '🫒' },
                            { word: 'זמן', translation: 'זמן', emoji: '⏰' },
                            { word: 'זכוכית', translation: 'זכוכית', emoji: '🪟' },
                            { word: 'זוג', translation: 'זוג', emoji: '👫' },
                            { word: 'זנב', translation: 'זנב', emoji: '🐕' },
                            { word: 'זרק', translation: 'זרק', emoji: '⚾' }
                        ]
                    },
                    'ח': {
                        start: [
                            { word: 'חתול', translation: 'חתול', emoji: '🐱' },
                            { word: 'חלב', translation: 'חלב', emoji: '🥛' },
                            { word: 'חום', translation: 'חום', emoji: '🟤' },
                            { word: 'חג', translation: 'חג', emoji: '🎊' },
                            { word: 'חלון', translation: 'חלון', emoji: '🪟' },
                            { word: 'חרב', translation: 'חרב', emoji: '⚔️' },
                            { word: 'חבר', translation: 'חבר', emoji: '👫' },
                            { word: 'חכם', translation: 'חכם', emoji: '🧠' },
                            { word: 'חזיר', translation: 'חזיר', emoji: '🐷' },
                            { word: 'חדר', translation: 'חדר', emoji: '🏠' }
                        ],
                        middle: [
                            { word: 'מחר', translation: 'מחר', emoji: '📅' },
                            { word: 'שחק', translation: 'שחק', emoji: '🎮' },
                            { word: 'בחירה', translation: 'בחירה', emoji: '✅' },
                            { word: 'מחשב', translation: 'מחשב', emoji: '💻' },
                            { word: 'רחוב', translation: 'רחוב', emoji: '🛣️' },
                            { word: 'שחור', translation: 'שחור', emoji: '⚫' },
                            { word: 'פחות', translation: 'פחות', emoji: '➖' },
                            { word: 'אחד', translation: 'אחד', emoji: '1️⃣' },
                            { word: 'נחש', translation: 'נחש', emoji: '🐍' },
                            { word: 'מחבר', translation: 'מחבר', emoji: '📚' }
                        ],
                        end: [
                            { word: 'רוח', translation: 'רוח', emoji: '💨' },
                            { word: 'כח', translation: 'כח', emoji: '💪' },
                            { word: 'פתח', translation: 'פתח', emoji: '🚪' },
                            { word: 'נח', translation: 'נח', emoji: '😴' },
                            { word: 'שח', translation: 'שח', emoji: '🗣️' },
                            { word: 'בח', translation: 'בח', emoji: '🎯' },
                            { word: 'לח', translation: 'לח', emoji: '💧' },
                            { word: 'רח', translation: 'רח', emoji: '🌊' },
                            { word: 'טח', translation: 'טח', emoji: '🎨' },
                            { word: 'זח', translation: 'זח', emoji: '🐛' }
                        ]
                    },
                    'ט': {
                        start: [
                            { word: 'טלפון', translation: 'טלפון', emoji: '📞' },
                            { word: 'טוב', translation: 'טוב', emoji: '👍' },
                            { word: 'טבעת', translation: 'טבעת', emoji: '💍' },
                            { word: 'טיפה', translation: 'טיפה', emoji: '💧' },
                            { word: 'טעם', translation: 'טעם', emoji: '👅' },
                            { word: 'טיול', translation: 'טיול', emoji: '🥾' },
                            { word: 'טלה', translation: 'טלה', emoji: '🐑' },
                            { word: 'טיל', translation: 'טיל', emoji: '🚀' },
                            { word: 'טבח', translation: 'טבח', emoji: '👨‍🍳' },
                            { word: 'טרקטור', translation: 'טרקטור', emoji: '🚜' }
                        ],
                        middle: [
                            { word: 'חיטה', translation: 'חיטה', emoji: '🌾' },
                            { word: 'קיטור', translation: 'קיטור', emoji: '💨' },
                            { word: 'גיטרה', translation: 'גיטרה', emoji: '🎸' },
                            { word: 'מיטה', translation: 'מיטה', emoji: '🛏️' },
                            { word: 'בטן', translation: 'בטן', emoji: '🤰' },
                            { word: 'מטבח', translation: 'מטבח', emoji: '🍳' },
                            { word: 'מטוס', translation: 'מטוס', emoji: '✈️' },
                            { word: 'קטן', translation: 'קטן', emoji: '🔸' },
                            { word: 'חטיף', translation: 'חטיף', emoji: '🍫' },
                            { word: 'שטיח', translation: 'שטיח', emoji: '🧿' }
                        ],
                        end: [
                            { word: 'חרוט', translation: 'חרוט', emoji: '📐' },
                            { word: 'שוט', translation: 'שוט', emoji: '🏹' },
                            { word: 'קיט', translation: 'קיט', emoji: '🧰' },
                            { word: 'חוט', translation: 'חוט', emoji: '🧵' },
                            { word: 'בט', translation: 'בט', emoji: '🏏' },
                            { word: 'גט', translation: 'גט', emoji: '📜' },
                            { word: 'חט', translation: 'חט', emoji: '🎯' },
                            { word: 'לט', translation: 'לט', emoji: '🤏' },
                            { word: 'מט', translation: 'מט', emoji: '⬇️' },
                            { word: 'נט', translation: 'נט', emoji: '📐' }
                        ]
                    },
                    'י': {
                        start: [
                            { word: 'יד', translation: 'יד', emoji: '✋' },
                            { word: 'ים', translation: 'ים', emoji: '🌊' },
                            { word: 'ירח', translation: 'ירח', emoji: '🌙' },
                            { word: 'יער', translation: 'יער', emoji: '🌲' },
                            { word: 'יין', translation: 'יין', emoji: '🍷' },
                            { word: 'יונה', translation: 'יונה', emoji: '🕊️' },
                            { word: 'יפה', translation: 'יפה', emoji: '😍' },
                            { word: 'ילד', translation: 'ילד', emoji: '👦' },
                            { word: 'ירק', translation: 'ירק', emoji: '🥬' },
                            { word: 'יהלום', translation: 'יהלום', emoji: '💎' }
                        ],
                        middle: [
                            { word: 'בית', translation: 'בית', emoji: '🏠' },
                            { word: 'חיים', translation: 'חיים', emoji: '🌱' },
                            { word: 'מיץ', translation: 'מיץ', emoji: '🧃' },
                            { word: 'ביצה', translation: 'ביצה', emoji: '🥚' },
                            { word: 'שיער', translation: 'שיער', emoji: '💇' },
                            { word: 'כיסא', translation: 'כיסא', emoji: '🪑' },
                            { word: 'מים', translation: 'מים', emoji: '💧' },
                            { word: 'תיק', translation: 'תיק', emoji: '🎒' },
                            { word: 'פיל', translation: 'פיל', emoji: '🐘' },
                            { word: 'גיטרה', translation: 'גיטרה', emoji: '🎸' }
                        ],
                        end: [
                            { word: 'קפה', translation: 'קפה', emoji: '☕' },
                            { word: 'חי', translation: 'חי', emoji: '🐾' },
                            { word: 'גבי', translation: 'גבי', emoji: '🔝' },
                            { word: 'בי', translation: 'בי', emoji: '👆' },
                            { word: 'לי', translation: 'לי', emoji: '👨' },
                            { word: 'שי', translation: 'שי', emoji: '🎁' },
                            { word: 'תי', translation: 'תי', emoji: '🍵' },
                            { word: 'כי', translation: 'כי', emoji: '❓' },
                            { word: 'מי', translation: 'מי', emoji: '❓' },
                            { word: 'פי', translation: 'פי', emoji: '👄' }
                        ]
                    },
                    'כ': {
                        start: [
                            { word: 'כלב', translation: 'כלב', emoji: '🐕' },
                            { word: 'כיסא', translation: 'כיסא', emoji: '🪑' },
                            { word: 'כוס', translation: 'כוס', emoji: '🥛' },
                            { word: 'כדור', translation: 'כדור', emoji: '⚽' },
                            { word: 'כף', translation: 'כף', emoji: '🥄' },
                            { word: 'כתר', translation: 'כתר', emoji: '👑' },
                            { word: 'כבש', translation: 'כבש', emoji: '🐑' },
                            { word: 'כובע', translation: 'כובע', emoji: '🎩' },
                            { word: 'כוכב', translation: 'כוכב', emoji: '⭐' },
                            { word: 'כרטיס', translation: 'כרטיס', emoji: '🎫' }
                        ],
                        middle: [
                            { word: 'בכיה', translation: 'בכיה', emoji: '😭' },
                            { word: 'מכונית', translation: 'מכונית', emoji: '🚗' },
                            { word: 'נכד', translation: 'נכד', emoji: '👦' },
                            { word: 'שכן', translation: 'שכן', emoji: '🏘️' },
                            { word: 'אוכל', translation: 'אוכל', emoji: '🍽️' },
                            { word: 'זכר', translation: 'זכר', emoji: '👨' },
                            { word: 'חכם', translation: 'חכם', emoji: '🧠' },
                            { word: 'רכב', translation: 'רכב', emoji: '🚙' },
                            { word: 'רופא', translation: 'רופא', emoji: '👨‍⚕️' },
                            { word: 'רוח', translation: 'רוח', emoji: '💨' },
                            { word: 'רמזור', translation: 'רמזור', emoji: '🚦' },
                            { word: 'רדיו', translation: 'רדיו', emoji: '📻' },
                            { word: 'רקטה', translation: 'רקטה', emoji: '🚀' },
                            { word: 'רצפה', translation: 'רצפה', emoji: '🏠' },
                            { word: 'רעב', translation: 'רעב', emoji: '🍽️' },
                            { word: 'רעש', translation: 'רעש', emoji: '🔊' }
                        ],
                        end: [
                            { word: 'נר', translation: 'נר', emoji: '🕯️' },
                            { word: 'הר', translation: 'הר', emoji: '🏔️' },
                            { word: 'בר', translation: 'בר', emoji: '🍺' },
                            { word: 'גר', translation: 'גר', emoji: '🏠' },
                            { word: 'דר', translation: 'דר', emoji: '🚪' },
                            { word: 'זר', translation: 'זר', emoji: '💐' },
                            { word: 'חר', translation: 'חר', emoji: '🔥' },
                            { word: 'כר', translation: 'כר', emoji: '🛏️' },
                            { word: 'פר', translation: 'פר', emoji: '🐂' },
                            { word: 'שר', translation: 'שר', emoji: '🎵' }
                        ]
                    },
                    'ש': {
                        start: [
                            { word: 'שמש', translation: 'שמש', emoji: '☀️' },
                            { word: 'שולחן', translation: 'שולחן', emoji: '🪑' },
                            { word: 'שעון', translation: 'שעון', emoji: '⏰' },
                            { word: 'שיער', translation: 'שיער', emoji: '💇' },
                            { word: 'שוקולד', translation: 'שוקולד', emoji: '🍫' },
                            { word: 'שלג', translation: 'שלג', emoji: '❄️' },
                            { word: 'שף', translation: 'שף', emoji: '👨‍🍳' },
                            { word: 'שקט', translation: 'שקט', emoji: '🤫' },
                            { word: 'שמיכה', translation: 'שמיכה', emoji: '🛏️' },
                            { word: 'שורש', translation: 'שורש', emoji: '🌱' }
                        ],
                        middle: [
                            { word: 'משחק', translation: 'משחק', emoji: '🎮' },
                            { word: 'נשר', translation: 'נשר', emoji: '🦅' },
                            { word: 'בשר', translation: 'בשר', emoji: '🥩' },
                            { word: 'כושר', translation: 'כושר', emoji: '💪' },
                            { word: 'אישה', translation: 'אישה', emoji: '👩' },
                            { word: 'פשוט', translation: 'פשוט', emoji: '✅' },
                            { word: 'חשוב', translation: 'חשוב', emoji: '❗' },
                            { word: 'משפחה', translation: 'משפחה', emoji: '👨‍👩‍👧‍👦' },
                            { word: 'קשה', translation: 'קשה', emoji: '💪' },
                            { word: 'נושא', translation: 'נושא', emoji: '📚' }
                        ],
                        end: [
                            { word: 'לחש', translation: 'לחש', emoji: '🤫' },
                            { word: 'רש', translation: 'רש', emoji: '💸' },
                            { word: 'נש', translation: 'נש', emoji: '🐍' },
                            { word: 'יש', translation: 'יש', emoji: '✅' },
                            { word: 'בש', translation: 'בש', emoji: '🎯' },
                            { word: 'גש', translation: 'גש', emoji: '🌧️' },
                            { word: 'דש', translation: 'דש', emoji: '🌾' },
                            { word: 'כש', translation: 'כש', emoji: '⏰' },
                            { word: 'מש', translation: 'מש', emoji: '👆' },
                            { word: 'פש', translation: 'פש', emoji: '🐟' }
                        ]
                    },
                    'ת': {
                        start: [
                            { word: 'תפוח', translation: 'תפוח', emoji: '🍎' },
                            { word: 'תות', translation: 'תות', emoji: '🍓' },
                            { word: 'תינוק', translation: 'תינוק', emoji: '👶' },
                            { word: 'תיק', translation: 'תיק', emoji: '🎒' },
                            { word: 'תרנגול', translation: 'תרנגול', emoji: '🐓' },
                            { word: 'תחנה', translation: 'תחנה', emoji: '🚉' },
                            { word: 'תמונה', translation: 'תמונה', emoji: '📸' },
                            { word: 'תלמיד', translation: 'תלמיד', emoji: '👨‍🎓' },
                            { word: 'תכלת', translation: 'תכלת', emoji: '🔵' },
                            { word: 'תווית', translation: 'תווית', emoji: '🏷️' }
                        ],
                        middle: [
                            { word: 'בית', translation: 'בית', emoji: '🏠' },
                            { word: 'חתול', translation: 'חתול', emoji: '🐱' },
                            { word: 'פותח', translation: 'פותח', emoji: '🔓' },
                            { word: 'שותה', translation: 'שותה', emoji: '🥤' },
                            { word: 'כותב', translation: 'כותב', emoji: '✍️' },
                            { word: 'מתוק', translation: 'מתוק', emoji: '🍯' },
                            { word: 'נותן', translation: 'נותן', emoji: '🤲' },
                            { word: 'רותח', translation: 'רותח', emoji: '🔥' },
                            { word: 'פיתה', translation: 'פיתה', emoji: '🥙' },
                            { word: 'גיתר', translation: 'גיתר', emoji: '🎸' }
                        ],
                        end: [
                            { word: 'בת', translation: 'בת', emoji: '👧' },
                            { word: 'את', translation: 'את', emoji: '👩' },
                            { word: 'דלת', translation: 'דלת', emoji: '🚪' },
                            { word: 'חלת', translation: 'חלת', emoji: '🍞' },
                            { word: 'גת', translation: 'גת', emoji: '🍇' },
                            { word: 'שת', translation: 'שת', emoji: '🍼' },
                            { word: 'פת', translation: 'פת', emoji: '🍞' },
                            { word: 'קת', translation: 'קת', emoji: '📏' },
                            { word: 'רת', translation: 'רת', emoji: '🔗' },
                            { word: 'נת', translation: 'נת', emoji: '💤' }
                        ]
                    },
                    'ר': {
                        start: [
                            { word: 'רכב', translation: 'רכב', emoji: '🚗' },
                            { word: 'רגל', translation: 'רגל', emoji: '🦵' },
                            { word: 'ראש', translation: 'ראש', emoji: '🗣️' },
                            { word: 'רוח', translation: 'רוח', emoji: '💨' },
                            { word: 'רקדן', translation: 'רקדן', emoji: '💃' },
                            { word: 'רחוב', translation: 'רחוב', emoji: '🛣️' },
                            { word: 'רמון', translation: 'רמון', emoji: '🍎' },
                            { word: 'רחם', translation: 'רחם', emoji: '❤️' },
                            { word: 'רפא', translation: 'רפא', emoji: '🏥' },
                            { word: 'רעם', translation: 'רעם', emoji: '⚡' }
                        ],
                        middle: [
                            { word: 'מרק', translation: 'מרק', emoji: '🍲' },
                            { word: 'ערב', translation: 'ערב', emoji: '🌆' },
                            { word: 'ירח', translation: 'ירח', emoji: '🌙' },
                            { word: 'ארץ', translation: 'ארץ', emoji: '🌍' },
                            { word: 'גרב', translation: 'גרב', emoji: '🧦' },
                            { word: 'חרב', translation: 'חרב', emoji: '⚔️' },
                            { word: 'דרך', translation: 'דרך', emoji: '🛣️' },
                            { word: 'ברך', translation: 'ברך', emoji: '🦵' },
                            { word: 'קרן', translation: 'קרן', emoji: '📯' },
                            { word: 'שרד', translation: 'שרד', emoji: '🏠' }
                        ],
                        end: [
                            { word: 'דבר', translation: 'דבר', emoji: '💬' },
                            { word: 'ספר', translation: 'ספר', emoji: '📚' },
                            { word: 'חמר', translation: 'חמר', emoji: '🍷' },
                            { word: 'זכר', translation: 'זכר', emoji: '👨' },
                            { word: 'נמר', translation: 'נמר', emoji: '🐅' },
                            { word: 'קבר', translation: 'קבר', emoji: '⚰️' },
                            { word: 'שער', translation: 'שער', emoji: '🚪' },
                            { word: 'נהר', translation: 'נהר', emoji: '🏞️' },
                            { word: 'עבר', translation: 'עבר', emoji: '⏪' },
                            { word: 'בקר', translation: 'בקר', emoji: '🌅' }
                        ]
                    },
                    'ק': {
                        start: [
                            { word: 'קפה', translation: 'קפה', emoji: '☕' },
                            { word: 'קרח', translation: 'קרח', emoji: '🧊' },
                            { word: 'קלף', translation: 'קלף', emoji: '📜' },
                            { word: 'קיץ', translation: 'קיץ', emoji: '☀️' },
                            { word: 'קול', translation: 'קול', emoji: '🔊' },
                            { word: 'קשת', translation: 'קשת', emoji: '🌈' },
                            { word: 'קנה', translation: 'קנה', emoji: '🛒' },
                            { word: 'קטן', translation: 'קטן', emoji: '🔸' },
                            { word: 'קודש', translation: 'קודש', emoji: '✨' },
                            { word: 'קיר', translation: 'קיר', emoji: '🧱' }
                        ],
                        middle: [
                            { word: 'מקום', translation: 'מקום', emoji: '📍' },
                            { word: 'חקר', translation: 'חקר', emoji: '🔍' },
                            { word: 'שקט', translation: 'שקט', emoji: '🤫' },
                            { word: 'תקן', translation: 'תקן', emoji: '🔧' },
                            { word: 'זקן', translation: 'זקן', emoji: '🧔' },
                            { word: 'נקה', translation: 'נקה', emoji: '🧽' },
                            { word: 'רקד', translation: 'רקד', emoji: '💃' },
                            { word: 'פקד', translation: 'פקד', emoji: '👮' },
                            { word: 'בקר', translation: 'בקר', emoji: '🐄' },
                            { word: 'שקע', translation: 'שקע', emoji: '🔌' }
                        ],
                        end: [
                            { word: 'חוק', translation: 'חוק', emoji: '⚖️' },
                            { word: 'שוק', translation: 'שוק', emoji: '🛒' },
                            { word: 'רוק', translation: 'רוק', emoji: '💧' },
                            { word: 'צוק', translation: 'צוק', emoji: '🏔️' },
                            { word: 'חיק', translation: 'חיק', emoji: '🤗' },
                            { word: 'שק', translation: 'שק', emoji: '👜' },
                            { word: 'דק', translation: 'דק', emoji: '📏' },
                            { word: 'חק', translation: 'חק', emoji: '📜' },
                            { word: 'לק', translation: 'לק', emoji: '💧' },
                            { word: 'תק', translation: 'תק', emoji: '📁' }
                        ]
                    },
                    'ג': {
                        start: [
                            { word: 'גמל', translation: 'גמל', emoji: '🐪' },
                            { word: 'גבר', translation: 'גבר', emoji: '👨' },
                            { word: 'גן', translation: 'גן', emoji: '🌳' },
                            { word: 'גדול', translation: 'גדול', emoji: '📏' },
                            { word: 'גזר', translation: 'גזר', emoji: '🥕' },
                            { word: 'גלגל', translation: 'גלגל', emoji: '🎡' },
                            { word: 'גבינה', translation: 'גבינה', emoji: '🧀' },
                            { word: 'גשם', translation: 'גשם', emoji: '🌧️' },
                            { word: 'גרב', translation: 'גרב', emoji: '🧦' },
                            { word: 'גיטרה', translation: 'גיטרה', emoji: '🎸' }
                        ],
                        middle: [
                            { word: 'מגן', translation: 'מגן', emoji: '🛡️' },
                            { word: 'בגד', translation: 'בגד', emoji: '👕' },
                            { word: 'דגל', translation: 'דגל', emoji: '🏁' },
                            { word: 'הגה', translation: 'הגה', emoji: '🚗' },
                            { word: 'וגם', translation: 'וגם', emoji: '➕' },
                            { word: 'זגוג', translation: 'זגוג', emoji: '🪟' },
                            { word: 'חגור', translation: 'חגור', emoji: '👖' },
                            { word: 'טגין', translation: 'טגין', emoji: '🍲' },
                            { word: 'יגיע', translation: 'יגיע', emoji: '💪' },
                            { word: 'כגון', translation: 'כגון', emoji: '📋' }
                        ],
                        end: [
                            { word: 'דג', translation: 'דג', emoji: '🐟' },
                            { word: 'חג', translation: 'חג', emoji: '🎊' },
                            { word: 'בג', translation: 'בג', emoji: '👕' },
                            { word: 'הג', translation: 'הג', emoji: '🎉' },
                            { word: 'וג', translation: 'וג', emoji: '🔗' },
                            { word: 'זג', translation: 'זג', emoji: '⚡' },
                            { word: 'טג', translation: 'טג', emoji: '🏷️' },
                            { word: 'יג', translation: 'יג', emoji: '💪' },
                            { word: 'כג', translation: 'כג', emoji: '⚖️' },
                            { word: 'לג', translation: 'לג', emoji: '🦵' }
                        ]
                    },
                    'ד': {
                        start: [
                            { word: 'דב', translation: 'דב', emoji: '🐻' },
                            { word: 'דלת', translation: 'דלת', emoji: '🚪' },
                            { word: 'דג', translation: 'דג', emoji: '🐟' },
                            { word: 'דם', translation: 'דם', emoji: '🩸' },
                            { word: 'דרך', translation: 'דרך', emoji: '🛣️' },
                            { word: 'דבש', translation: 'דבש', emoji: '🍯' },
                            { word: 'דקל', translation: 'דקל', emoji: '🌴' },
                            { word: 'דואר', translation: 'דואר', emoji: '📮' },
                            { word: 'דירה', translation: 'דירה', emoji: '🏠' },
                            { word: 'דחף', translation: 'דחף', emoji: '➡️' }
                        ],
                        middle: [
                            { word: 'מדע', translation: 'מדע', emoji: '🔬' },
                            { word: 'סדר', translation: 'סדר', emoji: '📋' },
                            { word: 'נדר', translation: 'נדר', emoji: '🤞' },
                            { word: 'חדש', translation: 'חדש', emoji: '🆕' },
                            { word: 'קדוש', translation: 'קדוש', emoji: '✨' },
                            { word: 'רדיו', translation: 'רדיו', emoji: '📻' },
                            { word: 'גדול', translation: 'גדול', emoji: '📏' },
                            { word: 'אדיב', translation: 'אדיב', emoji: '😊' },
                            { word: 'בדיקה', translation: 'בדיקה', emoji: '🔍' },
                            { word: 'ודאי', translation: 'ודאי', emoji: '✅' }
                        ],
                        end: [
                            { word: 'יד', translation: 'יד', emoji: '✋' },
                            { word: 'לד', translation: 'לד', emoji: '👶' },
                            { word: 'סוד', translation: 'סוד', emoji: '🤫' },
                            { word: 'מוד', translation: 'מוד', emoji: '📊' },
                            { word: 'קוד', translation: 'קוד', emoji: '💻' },
                            { word: 'בד', translation: 'בד', emoji: '🧵' },
                            { word: 'גד', translation: 'גד', emoji: '🐟' },
                            { word: 'הד', translation: 'הד', emoji: '📢' },
                            { word: 'וד', translation: 'ود', emoji: '🎣' },
                            { word: 'זד', translation: 'זד', emoji: '⚡' }
                        ]
                    },
                    'ה': {
                        start: [
                            { word: 'הר', translation: 'הר', emoji: '🏔️' },
                            { word: 'היד', translation: 'היד', emoji: '✋' },
                            { word: 'הבית', translation: 'הבית', emoji: '🏠' },
                            { word: 'האף', translation: 'האף', emoji: '👃' },
                            { word: 'הלב', translation: 'הלב', emoji: '❤️' },
                            { word: 'הגן', translation: 'הגן', emoji: '🌳' },
                            { word: 'הכלב', translation: 'הכלב', emoji: '🐕' },
                            { word: 'החתול', translation: 'החתול', emoji: '🐱' },
                            { word: 'הירח', translation: 'הירח', emoji: '🌙' },
                            { word: 'השמש', translation: 'השמש', emoji: '☀️' }
                        ],
                        middle: [
                            { word: 'בהיר', translation: 'בהיר', emoji: '🌟' },
                            { word: 'מהר', translation: 'מהר', emoji: '💨' },
                            { word: 'אוהב', translation: 'אוהב', emoji: '💕' },
                            { word: 'זוהר', translation: 'זוהר', emoji: '✨' },
                            { word: 'מהלך', translation: 'מהלך', emoji: '🚶' },
                            { word: 'תהליך', translation: 'תהליך', emoji: '⚙️' },
                            { word: 'שהות', translation: 'שהות', emoji: '⏳' },
                            { word: 'נהר', translation: 'נהר', emoji: '🏞️' },
                            { word: 'צהוב', translation: 'צהוב', emoji: '🟡' },
                            { word: 'קהל', translation: 'קהל', emoji: '👥' }
                        ],
                        end: [
                            { word: 'מה', translation: 'מה', emoji: '❓' },
                            { word: 'פה', translation: 'פה', emoji: '👄' },
                            { word: 'איה', translation: 'איה', emoji: '❓' },
                            { word: 'גה', translation: 'גה', emoji: '🎵' },
                            { word: 'בה', translation: 'בה', emoji: '👆' },
                            { word: 'לה', translation: 'לה', emoji: '👩' },
                            { word: 'זה', translation: 'זה', emoji: '👆' },
                            { word: 'שה', translation: 'שה', emoji: '🐑' },
                            { word: 'חה', translation: 'חה', emoji: '😄' },
                            { word: 'טה', translation: 'טה', emoji: '🎯' }
                        ]
                    },
                    'ו': {
                        start: [
                            { word: 'ורד', translation: 'ורד', emoji: '🌹' },
                            { word: 'ודאי', translation: 'ודאי', emoji: '✅' },
                            { word: 'וילון', translation: 'וילון', emoji: '🪟' },
                            { word: 'וופל', translation: 'וופל', emoji: '🧇' },
                            { word: 'ויטמין', translation: 'ויטמין', emoji: '💊' },
                            { word: 'וידאו', translation: 'וידאו', emoji: '📹' },
                            { word: 'ויזה', translation: 'ויזה', emoji: '📋' },
                            { word: 'וירוס', translation: 'וירוס', emoji: '🦠' },
                            { word: 'ווקה', translation: 'ווקה', emoji: '🍸' },
                            { word: 'ולווט', translation: 'ולווט', emoji: '⚡' }
                        ],
                        middle: [
                            { word: 'אוויר', translation: 'אוויר', emoji: '💨' },
                            { word: 'מועד', translation: 'מועד', emoji: '📅' },
                            { word: 'דווקא', translation: 'דווקא', emoji: '💯' },
                            { word: 'בוקר', translation: 'בוקר', emoji: '🌅' },
                            { word: 'צוואר', translation: 'צוואר', emoji: '🦒' },
                            { word: 'מוות', translation: 'מוות', emoji: '💀' },
                            { word: 'ראווה', translation: 'ראווה', emoji: '👀' },
                            { word: 'תווית', translation: 'תווית', emoji: '🏷️' },
                            { word: 'עוגה', translation: 'עוגה', emoji: '🎂' },
                            { word: 'מוזר', translation: 'מוזר', emoji: '🤔' }
                        ],
                        end: [
                            { word: 'פרו', translation: 'פרו', emoji: '🥩' },
                            { word: 'שלו', translation: 'שלו', emoji: '👨' },
                            { word: 'עליו', translation: 'עליו', emoji: '⬆️' },
                            { word: 'אליו', translation: 'אליו', emoji: '➡️' },
                            { word: 'בו', translation: 'בו', emoji: '👆' },
                            { word: 'לו', translation: 'לו', emoji: '👨' },
                            { word: 'פו', translation: 'פו', emoji: '💨' },
                            { word: 'בקרו', translation: 'בקרו', emoji: '🐄' },
                            { word: 'חלקו', translation: 'חלקו', emoji: '🍰' },
                            { word: 'דרכו', translation: 'דרכו', emoji: '🛣️' }
                        ]
                    },
                    'ז': {
                        start: [
                            { word: 'זבוב', translation: 'זבוב', emoji: '🪰' },
                            { word: 'זקן', translation: 'זקן', emoji: '🧔' },
                            { word: 'זרוע', translation: 'זרוע', emoji: '💪' },
                            { word: 'זהב', translation: 'זהב', emoji: '🥇' },
                            { word: 'זית', translation: 'זית', emoji: '🫒' },
                            { word: 'זמן', translation: 'זמן', emoji: '⏰' },
                            { word: 'זכוכית', translation: 'זכוכית', emoji: '🪟' },
                            { word: 'זוג', translation: 'זוג', emoji: '👫' },
                            { word: 'זנב', translation: 'זנב', emoji: '🐕' },
                            { word: 'זרק', translation: 'זרק', emoji: '⚾' }
                        ],
                        middle: [
                            { word: 'עזרה', translation: 'עזרה', emoji: '🤝' },
                            { word: 'בזמן', translation: 'בזמן', emoji: '⏰' },
                            { word: 'אוזן', translation: 'אוזן', emoji: '👂' },
                            { word: 'מזל', translation: 'מזל', emoji: '🍀' },
                            { word: 'חזק', translation: 'חזק', emoji: '💪' },
                            { word: 'רזה', translation: 'רזה', emoji: '🥒' },
                            { word: 'גזר', translation: 'גזר', emoji: '🥕' },
                            { word: 'עזה', translation: 'עזה', emoji: '💪' },
                            { word: 'תזה', translation: 'תזה', emoji: '📜' },
                            { word: 'מזון', translation: 'מזון', emoji: '🍽️' }
                        ],
                        end: [
                            { word: 'עז', translation: 'עז', emoji: '🐐' },
                            { word: 'בז', translation: 'בז', emoji: '🦅' },
                            { word: 'רז', translation: 'רז', emoji: '🤫' },
                            { word: 'גז', translation: 'גז', emoji: '⛽' },
                            { word: 'אז', translation: 'אז', emoji: '⏰' },
                            { word: 'לז', translation: 'לז', emoji: '😴' },
                            { word: 'חז', translation: 'חז', emoji: '👁️' },
                            { word: 'טז', translation: 'טז', emoji: '🎯' },
                            { word: 'קז', translation: 'קז', emoji: '🏃' },
                            { word: 'שז', translation: 'שז', emoji: '✨' }
                        ]
                    },
                    'ל': {
                        start: [
                            { word: 'לב', translation: 'לב', emoji: '❤️' },
                            { word: 'לחם', translation: 'לחם', emoji: '🍞' },
                            { word: 'לילה', translation: 'לילה', emoji: '🌙' },
                            { word: 'לימון', translation: 'לימון', emoji: '🍋' },
                            { word: 'ליצן', translation: 'ליצן', emoji: '🤡' },
                            { word: 'לוח', translation: 'לוח', emoji: '📋' },
                            { word: 'לשון', translation: 'לשון', emoji: '👅' },
                            { word: 'לבן', translation: 'לבן', emoji: '⚪' },
                            { word: 'לוז', translation: 'לוז', emoji: '🌰' },
                            { word: 'לקח', translation: 'לקח', emoji: '📚' }
                        ],
                        middle: [
                            { word: 'מלח', translation: 'מלח', emoji: '🧂' },
                            { word: 'בלע', translation: 'בלע', emoji: '😮' },
                            { word: 'גלה', translation: 'גלה', emoji: '🔍' },
                            { word: 'דלת', translation: 'דלת', emoji: '🚪' },
                            { word: 'הלך', translation: 'הלך', emoji: '🚶' },
                            { word: 'ולד', translation: 'ולד', emoji: '👶' },
                            { word: 'זלף', translation: 'זלף', emoji: '💧' },
                            { word: 'חלב', translation: 'חלב', emoji: '🥛' },
                            { word: 'טלה', translation: 'טלה', emoji: '🐑' },
                            { word: 'ילד', translation: 'ילד', emoji: '👦' }
                        ],
                        end: [
                            { word: 'אל', translation: 'אל', emoji: '⬆️' },
                            { word: 'בל', translation: 'בל', emoji: '🚫' },
                            { word: 'גל', translation: 'גל', emoji: '🌊' },
                            { word: 'דל', translation: 'דל', emoji: '🚪' },
                            { word: 'הל', translation: 'הל', emoji: '✨' },
                            { word: 'ול', translation: 'ול', emoji: '🔗' },
                            { word: 'זל', translation: 'זל', emoji: '💧' },
                            { word: 'חל', translation: 'חל', emoji: '🏖️' },
                            { word: 'טל', translation: 'טל', emoji: '💧' },
                            { word: 'יל', translation: 'יל', emoji: '👶' }
                        ]
                    },
                    'מ': {
                        start: [
                            { word: 'מים', translation: 'מים', emoji: '💧' },
                            { word: 'מכונית', translation: 'מכונית', emoji: '🚗' },
                            { word: 'מטוס', translation: 'מטוס', emoji: '✈️' },
                            { word: 'מחשב', translation: 'מחשב', emoji: '💻' },
                            { word: 'מקום', translation: 'מקום', emoji: '📍' },
                            { word: 'משפחה', translation: 'משפחה', emoji: '👪' },
                            { word: 'מלח', translation: 'מלח', emoji: '🧂' },
                            { word: 'מבט', translation: 'מבט', emoji: '👀' },
                            { word: 'מצב', translation: 'מצב', emoji: '📊' },
                            { word: 'מבחן', translation: 'מבחן', emoji: '📝' }
                        ],
                        middle: [
                            { word: 'זמן', translation: 'זמן', emoji: '⏰' },
                            { word: 'שמח', translation: 'שמח', emoji: '😊' },
                            { word: 'דמי', translation: 'דמי', emoji: '💰' },
                            { word: 'במה', translation: 'במה', emoji: '🎭' },
                            { word: 'למד', translation: 'למד', emoji: '📚' },
                            { word: 'המון', translation: 'המון', emoji: '👥' },
                            { word: 'קמח', translation: 'קמח', emoji: '🌾' },
                            { word: 'ממלא', translation: 'ממלא', emoji: '🔄' },
                            { word: 'תמיד', translation: 'תמיד', emoji: '🔄' },
                            { word: 'אמא', translation: 'אמא', emoji: '👩' }
                        ],
                        end: [
                            { word: 'אם', translation: 'אם', emoji: '👩' },
                            { word: 'בם', translation: 'בם', emoji: '📍' },
                            { word: 'גם', translation: 'גם', emoji: '➕' },
                            { word: 'דם', translation: 'דם', emoji: '🩸' },
                            { word: 'הם', translation: 'הם', emoji: '👥' },
                            { word: 'ום', translation: 'ום', emoji: '🌊' },
                            { word: 'זם', translation: 'זם', emoji: '⏰' },
                            { word: 'חם', translation: 'חם', emoji: '🔥' },
                            { word: 'טם', translation: 'טם', emoji: '👅' },
                            { word: 'ים', translation: 'ים', emoji: '🌊' }
                        ]
                    },
                    'נ': {
                        start: [
                            { word: 'נר', translation: 'נר', emoji: '🕯️' },
                            { word: 'נחש', translation: 'נחש', emoji: '🐍' },
                            { word: 'נהר', translation: 'נהר', emoji: '🏞️' },
                            { word: 'נוף', translation: 'נוף', emoji: '🏞️' },
                            { word: 'נגד', translation: 'נגד', emoji: '🚫' },
                            { word: 'נדר', translation: 'נדר', emoji: '🤞' },
                            { word: 'נקה', translation: 'נקה', emoji: '🧽' },
                            { word: 'נפל', translation: 'נפל', emoji: '⬇️' },
                            { word: 'נסע', translation: 'נסע', emoji: '🚗' },
                            { word: 'נתן', translation: 'נתן', emoji: '🤲' }
                        ],
                        middle: [
                            { word: 'אנחנו', translation: 'אנחנו', emoji: '👥' },
                            { word: 'בנה', translation: 'בנה', emoji: '🏗️' },
                            { word: 'גנב', translation: 'גנב', emoji: '🦹' },
                            { word: 'דנה', translation: 'דנה', emoji: '👩' },
                            { word: 'הנה', translation: 'הנה', emoji: '👆' },
                            { word: 'ונוס', translation: 'ונוס', emoji: '🪐' },
                            { word: 'זנב', translation: 'זנב', emoji: '🐕' },
                            { word: 'חנות', translation: 'חנות', emoji: '🏪' },
                            { word: 'טנק', translation: 'טנק', emoji: '🚗' },
                            { word: 'ינה', translation: 'ינה', emoji: '🕊️' }
                        ],
                        end: [
                            { word: 'אן', translation: 'אן', emoji: '❓' },
                            { word: 'בן', translation: 'בן', emoji: '👦' },
                            { word: 'גן', translation: 'גן', emoji: '🌳' },
                            { word: 'דן', translation: 'דן', emoji: '👨' },
                            { word: 'הן', translation: 'הן', emoji: '👩' },
                            { word: 'ון', translation: 'ון', emoji: '🔗' },
                            { word: 'זן', translation: 'זן', emoji: '🌱' },
                            { word: 'חן', translation: 'חן', emoji: '😊' },
                            { word: 'טן', translation: 'טן', emoji: '⚖️' },
                            { word: 'ין', translation: 'ין', emoji: '🍷' }
                        ]
                    },
                    'ס': {
                        start: [
                            { word: 'סוס', translation: 'סוס', emoji: '🐴' },
                            { word: 'ספר', translation: 'ספר', emoji: '📚' },
                            { word: 'סלט', translation: 'סלט', emoji: '🥗' },
                            { word: 'סכין', translation: 'סכין', emoji: '🔪' },
                            { word: 'סבא', translation: 'סבא', emoji: '👴' },
                            { word: 'סדר', translation: 'סדר', emoji: '📋' },
                            { word: 'סיר', translation: 'סיר', emoji: '🍲' },
                            { word: 'סוכר', translation: 'סוכר', emoji: '🍯' },
                            { word: 'ספה', translation: 'ספה', emoji: '🛋️' },
                            { word: 'סרט', translation: 'סרט', emoji: '🎬' }
                        ],
                        middle: [
                            { word: 'בסיס', translation: 'בסיס', emoji: '🏗️' },
                            { word: 'גשר', translation: 'גשר', emoji: '🌉' },
                            { word: 'דרש', translation: 'דרש', emoji: '📢' },
                            { word: 'השק', translation: 'השק', emoji: '👜' },
                            { word: 'ושר', translation: 'ושר', emoji: '🎵' },
                            { word: 'זמר', translation: 'זמר', emoji: '🎤' },
                            { word: 'חסר', translation: 'חסר', emoji: '❌' },
                            { word: 'טעם', translation: 'טעם', emoji: '👅' },
                            { word: 'יסוד', translation: 'יסוד', emoji: '🧪' },
                            { word: 'כסף', translation: 'כסף', emoji: '💰' }
                        ],
                        end: [
                            { word: 'אס', translation: 'אס', emoji: '🎯' },
                            { word: 'בס', translation: 'בס', emoji: '🔊' },
                            { word: 'גס', translation: 'גס', emoji: '💪' },
                            { word: 'דס', translation: 'דס', emoji: '🌾' },
                            { word: 'הס', translation: 'הס', emoji: '🤫' },
                            { word: 'וס', translation: 'וס', emoji: '🔗' },
                            { word: 'זס', translation: 'זס', emoji: '⚡' },
                            { word: 'חס', translation: 'חס', emoji: '🛡️' },
                            { word: 'טס', translation: 'טס', emoji: '✈️' },
                            { word: 'יס', translation: 'יס', emoji: '✅' }
                        ]
                    },
                    'ע': {
                        start: [
                            { word: 'עץ', translation: 'עץ', emoji: '🌳' },
                            { word: 'עין', translation: 'עין', emoji: '👁️' },
                            { word: 'עוגה', translation: 'עוגה', emoji: '🎂' },
                            { word: 'עוף', translation: 'עוף', emoji: '🐔' },
                            { word: 'עמוד', translation: 'עמוד', emoji: '🏛️' },
                            { word: 'עשן', translation: 'עשן', emoji: '💨' },
                            { word: 'עולם', translation: 'עולם', emoji: '🌍' },
                            { word: 'עבד', translation: 'עבד', emoji: '👷' },
                            { word: 'עגל', translation: 'עגל', emoji: '🐄' },
                            { word: 'עדה', translation: 'עדה', emoji: '👥' }
                        ],
                        middle: [
                            { word: 'בעד', translation: 'בעד', emoji: '👍' },
                            { word: 'געש', translation: 'געש', emoji: '🌋' },
                            { word: 'דעת', translation: 'דעת', emoji: '🧠' },
                            { word: 'העליון', translation: 'העליון', emoji: '⬆️' },
                            { word: 'ועד', translation: 'ועד', emoji: '📋' },
                            { word: 'זעם', translation: 'זעם', emoji: '😠' },
                            { word: 'חעס', translation: 'חעס', emoji: '😡' },
                            { word: 'טעם', translation: 'טעם', emoji: '👅' },
                            { word: 'יעד', translation: 'יעד', emoji: '🎯' },
                            { word: 'כעס', translation: 'כעס', emoji: '😠' }
                        ],
                        end: [
                            { word: 'אע', translation: 'אע', emoji: '😮' },
                            { word: 'בע', translation: 'בע', emoji: '🐑' },
                            { word: 'גע', translation: 'גע', emoji: '👉' },
                            { word: 'דע', translation: 'דע', emoji: '🧠' },
                            { word: 'הע', translation: 'הע', emoji: '😯' },
                            { word: 'וע', translation: 'וע', emoji: '🔗' },
                            { word: 'זע', translation: 'זע', emoji: '💨' },
                            { word: 'חע', translation: 'חע', emoji: '😮' },
                            { word: 'טע', translation: 'טע', emoji: '👅' },
                            { word: 'יע', translation: 'יע', emoji: '✅' }
                        ]
                    },
                    'פ': {
                        start: [
                            { word: 'פרח', translation: 'פרח', emoji: '🌸' },
                            { word: 'פיל', translation: 'פיל', emoji: '🐘' },
                            { word: 'פרי', translation: 'פרי', emoji: '🍎' },
                            { word: 'פנים', translation: 'פנים', emoji: '😊' },
                            { word: 'פרפר', translation: 'פרפר', emoji: '🦋' },
                            { word: 'פתח', translation: 'פתח', emoji: '🚪' },
                            { word: 'פרס', translation: 'פרס', emoji: '🏆' },
                            { word: 'פעמון', translation: 'פעמון', emoji: '🔔' },
                            { word: 'פינה', translation: 'פינה', emoji: '📐' },
                            { word: 'פלא', translation: 'פלא', emoji: '🌟' }
                        ],
                        middle: [
                            { word: 'אופן', translation: 'אופן', emoji: '🚲' },
                            { word: 'בפוך', translation: 'בפוך', emoji: '🔄' },
                            { word: 'גפן', translation: 'גפן', emoji: '🍇' },
                            { word: 'דפק', translation: 'דפק', emoji: '🚪' },
                            { word: 'הפך', translation: 'הפך', emoji: '🔄' },
                            { word: 'ופל', translation: 'ופל', emoji: '🧇' },
                            { word: 'זפת', translation: 'זפת', emoji: '🛣️' },
                            { word: 'חפש', translation: 'חפש', emoji: '🔍' },
                            { word: 'טפח', translation: 'טפח', emoji: '👏' },
                            { word: 'יפה', translation: 'יפה', emoji: '😍' }
                        ],
                        end: [
                            { word: 'אף', translation: 'אף', emoji: '👃' },
                            { word: 'בף', translation: 'בף', emoji: '🔊' },
                            { word: 'גף', translation: 'גף', emoji: '🍇' },
                            { word: 'דף', translation: 'דף', emoji: '📄' },
                            { word: 'הף', translation: 'הף', emoji: '💨' },
                            { word: 'וף', translation: 'וף', emoji: '🐦' },
                            { word: 'זף', translation: 'זף', emoji: '⚡' },
                            { word: 'חף', translation: 'חף', emoji: '🏖️' },
                            { word: 'טף', translation: 'טף', emoji: '👶' },
                            { word: 'יף', translation: 'יף', emoji: '😍' }
                        ]
                    },
                    'צ': {
                        start: [
                            { word: 'צבע', translation: 'צבע', emoji: '🎨' },
                            { word: 'צב', translation: 'צב', emoji: '🐢' },
                            { word: 'צל', translation: 'צל', emoji: '🌲' },
                            { word: 'צעצוע', translation: 'צעצוע', emoji: '🧸' },
                            { word: 'צוואר', translation: 'צוואר', emoji: '🦒' },
                            { word: 'צחק', translation: 'צחק', emoji: '😂' },
                            { word: 'צריח', translation: 'צריח', emoji: '🗼' },
                            { word: 'צפון', translation: 'צפון', emoji: '🧭' },
                            { word: 'צינור', translation: 'צינור', emoji: '🚰' },
                            { word: 'צמח', translation: 'צמח', emoji: '🌱' }
                        ],
                        middle: [
                            { word: 'אצבע', translation: 'אצבע', emoji: '👆' },
                            { word: 'בצל', translation: 'בצל', emoji: '🧅' },
                            { word: 'גצבי', translation: 'גצבי', emoji: '🦌' },
                            { word: 'דצמבר', translation: 'דצמבר', emoji: '❄️' },
                            { word: 'הצג', translation: 'הצג', emoji: '🎭' },
                            { word: 'וצה', translation: 'וצה', emoji: '🏃' },
                            { word: 'זצה', translation: 'זצה', emoji: '⚡' },
                            { word: 'חצי', translation: 'חצי', emoji: '½' },
                            { word: 'טצה', translation: 'טצה', emoji: '🎯' },
                            { word: 'יצא', translation: 'יצא', emoji: '🚪' }
                        ],
                        end: [
                            { word: 'אץ', translation: 'אץ', emoji: '💨' },
                            { word: 'בץ', translation: 'בץ', emoji: '🥚' },
                            { word: 'גץ', translation: 'גץ', emoji: '⚡' },
                            { word: 'דץ', translation: 'דץ', emoji: '🏹' },
                            { word: 'הץ', translation: 'הץ', emoji: '💨' },
                            { word: 'וץ', translation: 'וץ', emoji: '🔗' },
                            { word: 'זץ', translation: 'זץ', emoji: '⚡' },
                            { word: 'חץ', translation: 'חץ', emoji: '🏹' },
                            { word: 'טץ', translation: 'טץ', emoji: '🎯' },
                            { word: 'יץ', translation: 'יץ', emoji: '🌞' }
                        ]
                    }
                };

                // Add more letters with similar structure
                const additionalLetters = ['ך', 'ם', 'ן', 'ף', 'ץ'];
                additionalLetters.forEach(letter => {
                    this.words[letter] = {
                        start: Array(10).fill().map((_, i) => ({
                            word: `${letter}${i + 1}`,
                            translation: `מילה ${i + 1}`,
                            emoji: '📝'
                        })),
                        middle: Array(10).fill().map((_, i) => ({
                            word: `מ${letter}${i + 1}`,
                            translation: `מילה ${i + 1}`,
                            emoji: '📝'
                        })),
                        end: Array(10).fill().map((_, i) => ({
                            word: `${i + 1}${letter}`,
                            translation: `מילה ${i + 1}`,
                            emoji: '📝'
                        }))
                    };
                });
            }

            populateWordsDisplay() {
                const wordsList = document.getElementById('wordsList');
                if (!wordsList) {
                    console.log('wordsList element not found');
                    return;
                }

                const allWords = [];

                // Collect all words with their emojis
                Object.keys(this.words).forEach(letter => {
                    ['start', 'middle', 'end'].forEach(position => {
                        if (this.words[letter][position]) {
                            this.words[letter][position].slice(0, 2).forEach(wordObj => {
                                allWords.push(`${wordObj.emoji} ${wordObj.word}`);
                            });
                        }
                    });
                });

                console.log('Total words collected:', allWords.length);

                // Clear existing content
                wordsList.innerHTML = '';

                // Display first 30 words to avoid overcrowding
                allWords.forEach(wordText => {
                    const wordItem = document.createElement('span');
                    wordItem.className = 'word-item';
                    wordItem.textContent = wordText;
                    wordsList.appendChild(wordItem);
                });

                console.log('Words display populated with', allWords.length, 'words');
            }

            async populateVoicesDisplay() {
                const voicesList = document.getElementById('voicesList');
                if (!voicesList) {
                    console.log('voicesList element not found');
                    return;
                }

                // Clear existing content
                voicesList.innerHTML = '<div class="voice-item">Loading voices...</div>';

                let voices = speechSynthesis.getVoices();

                try {
                    // Wait for voices to be loaded properly
                    voices = await this.waitForVoices();

                    // Clear loading message
                    voicesList.innerHTML = '';

                    if (voices.length === 0) {
                        voicesList.innerHTML = '<div class="voice-item">No voices available</div>';
                        return;
                    }
                } catch (error) {
                    console.error('Error loading voices:', error);
                    voicesList.innerHTML = '<div class="voice-item">Error loading voices</div>';
                    return;
                }

                console.log('Total voices available:', voices.length);

                // Separate Hebrew and other voices
                const hebrewVoices = voices.filter(voice =>
                    voice.lang.startsWith('he') || voice.lang.includes('IL')
                );
                const otherVoices = voices.filter(voice =>
                    !voice.lang.startsWith('he') && !voice.lang.includes('IL')
                );

                // Combine Hebrew first, then others (limit to 8 total)
                const prioritizedVoices = [
                    ...hebrewVoices.slice(0, 3),
                    ...otherVoices.slice(0, 5)
                ];

                // Display voices
                prioritizedVoices.forEach((voice) => {
                    const voiceItem = document.createElement('div');
                    voiceItem.className = 'voice-item';

                    // Add hebrew class for Hebrew voices
                    if (voice.lang.startsWith('he') || voice.lang.includes('IL')) {
                        voiceItem.classList.add('hebrew');
                    }

                    // Display voice name and language
                    let voiceText = `${voice.name} (${voice.lang})`;
                    if (voice.default) voiceText += ' ⭐';

                    voiceItem.textContent = voiceText;
                    voicesList.appendChild(voiceItem);
                });

                console.log('Voices display populated with', prioritizedVoices.length, 'voices');
            }

            initializeVoiceSelection() {
                const voiceSelect = document.getElementById('voiceSelect');
                const selectedVoiceInfo = document.getElementById('selectedVoiceInfo');

                if (!voiceSelect) return;

                // Function to populate voices dropdown
                const populateVoiceDropdown = () => {
                    const voices = speechSynthesis.getVoices();

                    if (voices.length === 0) {
                        setTimeout(populateVoiceDropdown, 100);
                        return;
                    }

                    // Clear existing options
                    voiceSelect.innerHTML = '';

                    // Separate Hebrew and other voices
                    const hebrewVoices = voices.filter(voice =>
                        voice.lang.startsWith('he') || voice.lang.includes('IL')
                    );
                    const otherVoices = voices.filter(voice =>
                        !voice.lang.startsWith('he') && !voice.lang.includes('IL')
                    );

                    // Add Hebrew voices first
                    if (hebrewVoices.length > 0) {
                        const hebrewGroup = document.createElement('optgroup');
                        hebrewGroup.label = 'עברית (Hebrew)';
                        hebrewVoices.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.name;
                            option.textContent = `${voice.name} (${voice.lang})${voice.default ? ' ⭐' : ''}`;
                            hebrewGroup.appendChild(option);
                        });
                        voiceSelect.appendChild(hebrewGroup);
                    }

                    // Add other voices
                    if (otherVoices.length > 0) {
                        const otherGroup = document.createElement('optgroup');
                        otherGroup.label = 'Other Languages';
                        otherVoices.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.name;
                            option.textContent = `${voice.name} (${voice.lang})${voice.default ? ' ⭐' : ''}`;
                            otherGroup.appendChild(option);
                        });
                        voiceSelect.appendChild(otherGroup);
                    }

                    // Set default selection (prefer Hebrew voice)
                    const hebrewVoice = hebrewVoices.find(voice => voice.default) || hebrewVoices[0];
                    const defaultVoice = hebrewVoice || voices.find(voice => voice.default) || voices[0];

                    if (defaultVoice) {
                        voiceSelect.value = defaultVoice.name;
                        this.selectedVoice = defaultVoice;
                        this.updateSelectedVoiceInfo();
                    }
                };

                // Voice selection change handler
                voiceSelect.addEventListener('change', (e) => {
                    const voices = speechSynthesis.getVoices();
                    this.selectedVoice = voices.find(voice => voice.name === e.target.value);
                    this.updateSelectedVoiceInfo();
                });

                // Load voices
                populateVoiceDropdown();

                // Chrome loads voices asynchronously
                window.speechSynthesis.onvoiceschanged = () => {
                    populateVoiceDropdown();
                };
            }

            updateSelectedVoiceInfo() {
                const selectedVoiceInfo = document.getElementById('selectedVoiceInfo');
                if (!selectedVoiceInfo || !this.selectedVoice) return;

                selectedVoiceInfo.textContent = `נבחר: ${this.selectedVoice.name} (${this.selectedVoice.lang})${this.selectedVoice.default ? ' - קול ברירת מחדל' : ''}`;
            }

            initializeUI() {
                // Hebrew alphabet in correct order א-ת
                const hebrewAlphabet = [
                    'א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ז', 'ח', 'ט', 'י',
                    'כ', 'ל', 'מ', 'נ', 'ס', 'ע', 'פ', 'צ', 'ק', 'ר',
                    'ש', 'ת'
                ];

                // Filter to only include letters that have words defined
                const availableLetters = hebrewAlphabet.filter(letter => this.words[letter]);
                const lettersGrid = document.getElementById('lettersGrid');

                availableLetters.forEach(letter => {
                    const btn = document.createElement('button');
                    btn.className = 'letter-btn';
                    btn.textContent = letter;
                    btn.addEventListener('click', () => this.selectLetter(letter));
                    lettersGrid.appendChild(btn);
                });

                this.updateScore();
                this.updateSimilarityScore();

                // Populate displays after DOM elements are ready
                this.populateWordsDisplay();
                this.populateVoicesDisplay(); // Now async but doesn't need await
            }

            setupEventListeners() {
                // Position selector
                document.querySelectorAll('.position-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.position-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentPosition = e.target.dataset.position;
                        if (this.selectedLetter) {
                            this.loadRandomWord();
                        }
                    });
                });

                // Control buttons
                document.getElementById('playWordBtn').addEventListener('click', () => this.playWord());
                document.getElementById('recordBtn').addEventListener('click', () => this.toggleRecording());
                document.getElementById('playRecordingBtn').addEventListener('click', () => this.playRecording());
                document.getElementById('analyzeSimilarityBtn').addEventListener('click', () => this.analyzeSimilarity());
                document.getElementById('nextWordBtn').addEventListener('click', () => this.loadRandomWord());

                // TTS Method selection
                const ttsMethodSelect = document.getElementById('ttsMethodSelect');
                if (ttsMethodSelect) {
                    ttsMethodSelect.addEventListener('change', () => this.updateTTSMethodInfo());
                }
            }

            updateTTSMethodInfo() {
                const ttsMethodSelect = document.getElementById('ttsMethodSelect');
                const selectedTTSInfo = document.getElementById('selectedTTSInfo');

                if (!ttsMethodSelect || !selectedTTSInfo) return;

                const selectedMethod = ttsMethodSelect.value;
                let infoText = '';

                switch (selectedMethod) {
                    case 'playWithLocalTTS':
                        infoText = 'נבחר: TTS מקומי (דפדפן) - משתמש בקולות המערכת';
                        break;
                    case 'playWithGoogleTTSProxy':
                    default:
                        infoText = 'נבחר: Google TTS (דרך Proxy) - עוקף חסימות CORS';
                        break;
                }

                selectedTTSInfo.textContent = infoText;
            }

            async autoSelectTTSMethod() {
                // Wait for voices to be loaded
                const voices = await this.waitForVoices();

                // Check if Hebrew voices are available
                const hebrewVoices = voices.filter(voice =>
                    voice.lang.toLowerCase().includes('he') ||
                    voice.lang.toLowerCase().includes('iw') ||
                    voice.name.toLowerCase().includes('hebrew') ||
                    voice.name.toLowerCase().includes('עברית')
                );

                console.log('Available Hebrew voices:', hebrewVoices.length);
                console.log('Hebrew voices found:', hebrewVoices.map(v => `${v.name} (${v.lang})`));

                const ttsMethodSelect = document.getElementById('ttsMethodSelect');
                if (!ttsMethodSelect) return;

                if (hebrewVoices.length > 0) {
                    // Hebrew voices available - use local TTS
                    ttsMethodSelect.value = 'playWithLocalTTS';
                    console.log('✅ Hebrew voices found - selecting Local TTS');
                } else {
                    // No Hebrew voices - use Google TTS Proxy
                    ttsMethodSelect.value = 'playWithGoogleTTSProxy';
                    console.log('❌ No Hebrew voices found - selecting Google TTS Proxy');
                }

                // Update the info text after selection
                this.updateTTSMethodInfo();
            }

            async waitForVoices() {
                return new Promise((resolve) => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        resolve(voices);
                    } else {
                        speechSynthesis.onvoiceschanged = () => {
                            resolve(speechSynthesis.getVoices());
                        };
                    }
                });
            }

            selectLetter(letter) {
                document.querySelectorAll('.letter-btn').forEach(btn => btn.classList.remove('selected'));
                event.target.classList.add('selected');

                this.selectedLetter = letter;
                document.getElementById('gameArea').classList.add('active');
                this.loadRandomWord();
                this.showFeedback(`נבחרה האות: ${letter}`, 'info');
            }

            loadRandomWord() {
                if (!this.selectedLetter) return;

                const wordsForPosition = this.words[this.selectedLetter][this.currentPosition];
                const randomIndex = Math.floor(Math.random() * wordsForPosition.length);
                this.currentWord = wordsForPosition[randomIndex];

                document.getElementById('wordImage').textContent = this.currentWord.emoji;
                document.getElementById('wordText').textContent = this.currentWord.word;
                document.getElementById('wordTranslation').textContent = this.currentWord.translation;

                // Reset recording state
                document.getElementById('playRecordingBtn').disabled = true;
                document.getElementById('analyzeSimilarityBtn').disabled = true;
                this.recordedAudio = null;
                document.getElementById('feedback').style.display = 'none';
            }

            async playWord() {
                if (!this.currentWord) return;

                // Get selected TTS method from dropdown
                const ttsMethodSelect = document.getElementById('ttsMethodSelect');
                const selectedMethod = ttsMethodSelect ? ttsMethodSelect.value : 'playWithLocalTTS';

                // Call the appropriate TTS method
                switch (selectedMethod) {
                    case 'playWithLocalTTS':
                        this.playWithLocalTTS();
                        break;
                    case 'playWithGoogleTTSProxy':
                    default:
                        this.playWithGoogleTTSProxy();
                        break;
                }
            }

            async playWithLocalTTS() {
                try {
                    // Check if speech synthesis is available
                    if ('speechSynthesis' in window) {
                        // Cancel any ongoing speech
                        speechSynthesis.cancel();

                        // Wait for voices to be loaded with Promise-based approach
                        const voices = await this.waitForVoices();

                        // Check if Hebrew voices are available
                        const hebrewVoices = voices.filter(voice =>
                            voice.lang.toLowerCase().includes('he') ||
                            voice.lang.toLowerCase().includes('iw') ||
                            voice.name.toLowerCase().includes('hebrew') ||
                            voice.name.toLowerCase().includes('עברית') ||
                            voice.lang.startsWith('he') ||
                            voice.lang.includes('IL')
                        );

                        // If no Hebrew voices available, fallback to Google TTS Proxy
                        if (hebrewVoices.length === 0) {
                            console.log('No Hebrew voices available in local TTS, falling back to Google TTS Proxy');
                            this.showFeedback('🔊 אין קולות עבריים זמינים, משתמש ב-Google TTS', 'info');
                            return this.playWithGoogleTTSProxy();
                        }

                        const utterance = new SpeechSynthesisUtterance(this.currentWord.word);

                        // PC settings
                        utterance.rate = 0.7;
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;

                        // Use the selected voice from dropdown if available
                        let selectedVoice = this.selectedVoice;

                        // If no voice selected from dropdown, fall back to automatic selection
                        if (!selectedVoice) {
                            const availableVoices = speechSynthesis.getVoices();
                            console.log('No voice selected, finding best voice from:', availableVoices.map(v => `${v.name} (${v.lang})`));

                            // First try any Hebrew voices
                            selectedVoice = availableVoices.find(voice =>
                                voice.lang.startsWith('he') || voice.lang.includes('IL')
                            );

                            // If no Hebrew, try Arabic (similar sounds)
                            if (!selectedVoice) {
                                selectedVoice = availableVoices.find(voice =>
                                    voice.lang.startsWith('ar')
                                );
                            }

                            // If no Hebrew/Arabic, try any voice that's not English as fallback
                            if (!selectedVoice) {
                                selectedVoice = availableVoices.find(voice =>
                                    !voice.lang.startsWith('en')
                                );
                            }

                            // Last resort: use default voice
                            if (!selectedVoice && availableVoices.length > 0) {
                                selectedVoice = availableVoices[0];
                            }
                        }

                        if (selectedVoice) {
                            utterance.voice = selectedVoice;
                            utterance.lang = selectedVoice.lang;
                            console.log('Using voice:', selectedVoice.name, selectedVoice.lang);
                        } else {
                            utterance.lang = 'he-IL';
                        }

                        utterance.onerror = (event) => {
                            console.error('Speech synthesis error:', event.error);
                        };

                        utterance.onend = () => {
                            console.log('Speech synthesis completed successfully');
                        };

                        speechSynthesis.speak(utterance);

                    }
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                }
            }



            async playWithGoogleTTSProxy() {
                // Check if the browser supports web audio. Safari wants a prefix.
                if (!('AudioContext' in window || 'webkitAudioContext' in window)) {
                    console.log('Web Audio not supported, falling back to local TTS');
                    return this.playWithLocalTTS();
                }

                try {
                    console.log('🔊 Starting Google TTS with proxy...');

                    const word = encodeURIComponent(this.currentWord.word);
                    const googleTTSUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=he&client=tw-ob&q=${word}`;
                    const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=';
                    const URL = proxyUrl + encodeURIComponent(googleTTSUrl);

                    console.log('Word:', this.currentWord.word);
                    console.log('Using proxy URL:', URL);

                    // Initialize AudioContext - Make it crossbrowser
                    if (!this.audioContext) {
                        const AudioContext = window.AudioContext || window.webkitAudioContext;
                        this.audioContext = new AudioContext();
                        this.gainNode = this.audioContext.createGain();
                        this.gainNode.gain.value = 1; // set volume to 100%
                    }

                    //////////////////////////////////////////////////
                    // Here's the part for just playing an audio file.
                    //////////////////////////////////////////////////
                    const play = (audioBuffer) => {
                        const source = this.audioContext.createBufferSource();
                        source.buffer = audioBuffer;
                        source.connect(this.audioContext.destination);
                        source.start();

                        console.log('✅ Proxy TTS playback successful!');
                        this.showFeedback(`🔊 משמיע: ${this.currentWord.word} (Proxy)`, 'success');
                    };

                    //////////////////////////////////////////////////
                    // Here's the part for unlocking the audio context, probably for iOS only
                    //////////////////////////////////////////////////
                    const unlock = () => {
                        console.log("unlocking audio context");
                        // create empty buffer and play it
                        const buffer = this.audioContext.createBuffer(1, 1, 22050);
                        const source = this.audioContext.createBufferSource();
                        source.buffer = buffer;
                        source.connect(this.audioContext.destination);

                        // play the file. noteOn is the older version of start()
                        source.start ? source.start(0) : source.noteOn(0);

                        // by checking the play state after some time, we know if we're really unlocked
                        setTimeout(() => {
                            if ((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {
                                console.log("Audio context unlocked successfully");
                            }
                        }, 0);
                    };

                    // Try to unlock audio context for iOS
                    unlock();

                    // The Promise-based syntax for BaseAudioContext.decodeAudioData() is not supported in Safari(Webkit).
                    const response = await window.fetch(URL);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const arrayBuffer = await response.arrayBuffer();

                    // Use callback-based decodeAudioData for Safari compatibility
                    this.audioContext.decodeAudioData(
                        arrayBuffer,
                        audioBuffer => {
                            play(audioBuffer);
                        },
                        error => {
                            console.error('Audio decode error:', error);
                            throw error;
                        }
                    );

                } catch (error) {
                    console.error('❌ Google TTS with proxy failed:', error);

                    if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                        this.showFeedback('🌐 בעיית רשת - לא ניתן להתחבר לשירות Proxy', 'info');
                    } else if (error.message.includes('HTTP')) {
                        this.showFeedback(`🌐 שגיאת Proxy: ${error.message}`, 'info');
                    } else if (error.name === 'NotAllowedError') {
                        this.showFeedback('🔊 יש לאשר השמעת קול בדפדפן', 'info');
                    } else {
                        this.showFeedback(`🔊 שגיאת Proxy: ${error.message}`, 'info');
                    }

                    // Fallback to local TTS
                    console.log('Falling back to local TTS...');
                    this.playWithLocalTTS();
                }
            }

            async toggleRecording() {
                if (this.isRecording) {
                    this.stopRecording();
                } else {
                    await this.startRecording();
                }
            }

            async startRecording() {
                // Check if we're in an iframe (Claude.ai environment)
                if (window !== window.top) {
                    this.showFeedback('📱 להקלטת קול, שמור את המשחק כקובץ HTML ופתח בדפדפן', 'info');
                    return;
                }

                // Check if APIs are available
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    this.showFeedback('🎤 הקלטת קול לא נתמכת בסביבה זו', 'info');
                    return;
                }

                try {
                    // Request microphone permission with more specific constraints
                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true
                        }
                    });

                    // Choose the best supported MIME type
                    let mimeType = 'audio/wav'; // fallback
                    const supportedTypes = [
                        'audio/webm;codecs=opus',
                        'audio/webm',
                        'audio/ogg;codecs=opus',
                        'audio/mp4',
                        'audio/wav'
                    ];

                    for (const type of supportedTypes) {
                        if (MediaRecorder.isTypeSupported(type)) {
                            mimeType = type;
                            break;
                        }
                    }

                    this.mediaRecorder = new MediaRecorder(stream, { mimeType });
                    this.audioChunks = [];

                    this.mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            this.audioChunks.push(event.data);
                        }
                    };

                    this.mediaRecorder.onstop = () => {
                        try {
                            const audioBlob = new Blob(this.audioChunks, {
                                type: this.mediaRecorder.mimeType || 'audio/wav'
                            });
                            const audioUrl = window.nativeCreateObjectURL(audioBlob);
                            this.recordedAudio = new Audio(audioUrl);

                            // Add error handling for audio loading
                            this.recordedAudio.onerror = (e) => {
                                console.error('Audio loading error:', e);
                                this.showFeedback('שגיאה בטעינת ההקלטה', 'info');
                            };

                            this.recordedAudio.onloadeddata = () => {
                                document.getElementById('playRecordingBtn').disabled = false;
                                document.getElementById('analyzeSimilarityBtn').disabled = false;
                                this.showFeedback('הקלטה הושלמה! לחץ על ▶️ כדי לשמוע או 🎯 כדי לבדוק דמיון', 'success');
                            };

                            // Stop all tracks to free up the microphone
                            stream.getTracks().forEach(track => track.stop());
                        } catch (error) {
                            console.error('Error processing recording:', error);
                            this.showFeedback('שגיאה בעיבוד ההקלטה', 'info');
                        }
                    };

                    this.mediaRecorder.onerror = (event) => {
                        console.error('MediaRecorder error:', event.error);
                        this.showFeedback('שגיאה בהקלטה: ' + event.error.message, 'info');
                    };

                    this.mediaRecorder.start();
                    this.isRecording = true;

                    document.getElementById('recordBtn').textContent = '⏹️ עצור הקלטה';
                    document.getElementById('recordingIndicator').classList.add('active');

                    this.showFeedback('מקליט... דבר עכשיו!', 'info');

                    // Set 10-second timeout to automatically stop recording
                    this.recordingTimeout = setTimeout(() => {
                        if (this.isRecording) {
                            this.stopRecording();
                            this.showFeedback('הקלטה נעצרה אוטומטית לאחר 10 שניות', 'info');
                        }
                    }, 10000);

                } catch (error) {
                    console.error('Error accessing microphone:', error);

                    let errorMessage = '';
                    if (error.name === 'NotAllowedError') {
                        errorMessage = '🔒 אישור מיקרופון נדרש. לחץ על הנעילה בכתובת ואפשר מיקרופון, או שמור כקובץ HTML';
                    } else if (error.name === 'NotFoundError') {
                        errorMessage = '🎤 לא נמצא מיקרופון במכשיר';
                    } else if (error.name === 'NotSupportedError') {
                        errorMessage = '📱 שמור את המשחק כקובץ HTML לתמיכה מלאה במיקרופון';
                    } else {
                        errorMessage = '⚠️ שגיאת מיקרופון: ' + error.message;
                    }

                    this.showFeedback(errorMessage, 'info');

                    // Add download button for HTML version
                    this.addDownloadButton();
                }
            }

            addDownloadButton() {
                const existingBtn = document.getElementById('downloadBtn');
                if (existingBtn) return;

                const downloadBtn = document.createElement('button');
                downloadBtn.id = 'downloadBtn';
                downloadBtn.className = 'btn btn-primary';
                downloadBtn.innerHTML = '💾 שמור משחק למחשב';
                downloadBtn.onclick = () => this.downloadGame();

                document.querySelector('.controls').appendChild(downloadBtn);
            }

            downloadGame() {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = window.nativeCreateObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'hebrew-letter-game.html';
                a.click();

                window.nativeRevokeObjectURL(url);
                this.showFeedback('המשחק נשמר! פתח את הקובץ בדפדפן', 'success');
            }

            stopRecording() {
                // Clear the recording timeout if it exists
                if (this.recordingTimeout) {
                    clearTimeout(this.recordingTimeout);
                    this.recordingTimeout = null;
                }

                if (this.mediaRecorder && this.mediaRecorder.state === 'recording') {
                    this.mediaRecorder.stop();
                }

                this.isRecording = false;
                document.getElementById('recordBtn').textContent = '🎤 הקלט קולך';
                document.getElementById('recordingIndicator').classList.remove('active');
            }

            playRecording() {
                if (this.recordedAudio) {
                    try {
                        const playPromise = this.recordedAudio.play();

                        if (playPromise !== undefined) {
                            playPromise.then(() => {
                                this.score += 10;
                                this.updateScore();
                                this.showFeedback('כל הכבוד! קיבלת 10 נקודות!', 'success');
                            }).catch(error => {
                                console.error('Audio playback error:', error);
                                this.showFeedback('שגיאה בהשמעת ההקלטה', 'info');
                            });
                        }
                    } catch (error) {
                        console.error('Audio playback error:', error);
                        this.showFeedback('שגיאה בהשמעת ההקלטה', 'info');
                    }
                } else {
                    this.showFeedback('אין הקלטה זמינה', 'info');
                }
            }

            updateScore() {
                document.getElementById('score').textContent = `ניקוד: ${this.score}`;
            }

            updateSimilarityScore() {
                document.getElementById('similarityScore').textContent = `דמיון: ${this.similarityScore}%`;
            }

            initializeSpeechRecognition() {
                // Check if speech recognition is available
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.speechRecognition = new SpeechRecognition();

                    // Configure speech recognition for Hebrew (with fallback to English)
                    this.speechRecognition.lang = 'he-IL';
                    this.speechRecognition.interimResults = true; // Get interim results
                    this.speechRecognition.maxAlternatives = 3; // Get multiple alternatives
                    this.speechRecognition.continuous = true; // Keep listening

                    this.speechRecognition.onresult = (event) => {
                        console.log('Speech recognition result event:', event);

                        // Get the latest result
                        const lastResultIndex = event.results.length - 1;
                        const result = event.results[lastResultIndex];

                        if (result.isFinal) {
                            // Final result - use this for calculation
                            let bestTranscript = '';
                            for (let i = 0; i < result.length; i++) {
                                const transcript = result[i].transcript.trim();
                                if (transcript) {
                                    bestTranscript = transcript;
                                    console.log(`Alternative ${i}:`, transcript, 'confidence:', result[i].confidence);
                                    break;
                                }
                            }

                            this.recognizedText = bestTranscript;
                            console.log('Final recognized text:', this.recognizedText);
                            console.log('Target word:', this.currentWord.word);

                            // Stop listening after getting final result
                            this.speechRecognition.stop();

                            if (this.recognizedText) {
                                this.calculateSimilarity();
                            } else {
                                this.showFeedback('לא זוהה דיבור ברור. נסה שוב', 'info');
                            }
                        } else {
                            // Interim result - just show we're getting something
                            const transcript = result[0].transcript;
                            console.log('Interim result:', transcript);
                            if (transcript.trim()) {
                                this.showFeedback('זוהה: ' + transcript + ' (ממשיך לזהות...)', 'info');
                            }
                        }
                    };

                    this.speechRecognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);

                        // Provide specific error messages
                        if (event.error === 'no-speech') {
                            // Try to restart recognition automatically once
                            if (!this.speechRetryAttempted) {
                                this.speechRetryAttempted = true;
                                console.log('Retrying speech recognition...');
                                setTimeout(() => {
                                    try {
                                        this.speechRecognition.start();
                                        this.showFeedback('מנסה שוב... דבר עכשיו!', 'info');
                                    } catch (e) {
                                        console.error('Retry failed:', e);
                                        this.showFeedback('לא זוהה דיבור. ודא שהמיקרופון פועל', 'info');
                                    }
                                }, 500);
                            } else if (!this.englishFallbackAttempted) {
                                // Try English as fallback
                                this.englishFallbackAttempted = true;
                                console.log('Trying English speech recognition as fallback...');
                                this.speechRecognition.lang = 'en-US';
                                setTimeout(() => {
                                    try {
                                        this.speechRecognition.start();
                                        this.showFeedback('מנסה באנגלית... אמור את המילה באנגלית!', 'info');
                                    } catch (e) {
                                        console.error('English fallback failed:', e);
                                        this.offerManualInput();
                                    }
                                }, 500);
                            } else {
                                this.offerManualInput();
                            }
                        } else if (event.error === 'not-allowed') {
                            this.showFeedback('יש לאשר גישה למיקרופון בדפדפן', 'info');
                        } else if (event.error === 'language-not-supported') {
                            // Fallback to English if Hebrew is not supported
                            console.log('Hebrew not supported, trying English...');
                            this.speechRecognition.lang = 'en-US';
                            this.englishFallbackAttempted = true;
                            this.showFeedback('עברית לא נתמכת, מנסה באנגלית...', 'info');
                            try {
                                this.speechRecognition.start();
                            } catch (e) {
                                console.error('English fallback failed:', e);
                                this.offerManualInput();
                            }
                        } else {
                            this.showFeedback('שגיאה בזיהוי דיבור: ' + event.error, 'info');
                            this.offerManualInput();
                        }
                    };

                    this.speechRecognition.onend = () => {
                        console.log('Speech recognition ended');

                        // If no text was recognized, show message
                        if (!this.recognizedText) {
                            this.showFeedback('לא זוהה דיבור. ודא שהמיקרופון פועל ונסה שוב', 'info');
                        }
                    };
                } else {
                    console.log('Speech recognition not supported');
                }
            }

            analyzeSimilarity() {
                if (!this.currentWord) {
                    this.showFeedback('אין מילה נוכחית לניתוח', 'info');
                    return;
                }

                if (!this.speechRecognition) {
                    this.showFeedback('זיהוי דיבור לא נתמך בדפדפן זה', 'info');
                    return;
                }

                // Reset previous recognition
                this.recognizedText = '';
                this.similarityScore = 0;
                this.speechRetryAttempted = false;
                this.englishFallbackAttempted = false;
                this.speechRecognition.lang = 'he-IL'; // Reset to Hebrew
                this.updateSimilarityScore();

                try {
                    console.log('Starting speech recognition for word:', this.currentWord.word);
                    this.showFeedback('מאזין לדיבור... אמור את המילה עכשיו!', 'info');
                    this.speechRecognition.start();
                } catch (error) {
                    console.error('Speech recognition start error:', error);
                    if (error.name === 'InvalidStateError') {
                        // Speech recognition is already running, stop it first
                        this.speechRecognition.stop();
                        setTimeout(() => {
                            try {
                                this.speechRecognition.start();
                                this.showFeedback('מאזין לדיבור... אמור את המילה עכשיו!', 'info');
                            } catch (e) {
                                this.showFeedback('שגיאה בהפעלת זיהוי דיבור: ' + e.message, 'info');
                                this.offerManualInput();
                            }
                        }, 100);
                    } else {
                        this.showFeedback('שגיאה בהפעלת זיהוי דיבור: ' + error.message, 'info');
                        this.offerManualInput();
                    }
                }
            }

            calculateSimilarity() {
                if (!this.currentWord || !this.recognizedText) {
                    console.log('Missing data for similarity calculation:', {
                        currentWord: this.currentWord,
                        recognizedText: this.recognizedText
                    });
                    return;
                }

                const targetWord = this.currentWord.word;
                const spokenWord = this.recognizedText;

                console.log('Calculating similarity between:', { target: targetWord, spoken: spokenWord });

                // Calculate Levenshtein distance for similarity
                const similarity = this.calculateLevenshteinSimilarity(targetWord, spokenWord);
                this.similarityScore = Math.round(similarity * 100);

                console.log('Similarity score calculated:', this.similarityScore);
                this.updateSimilarityScore();

                // Provide feedback based on similarity score
                let feedback = '';
                let feedbackType = '';

                if (this.similarityScore >= 90) {
                    feedback = `מושלם! דמיון של ${this.similarityScore}% 🎉`;
                    feedbackType = 'success';
                    this.score += 20; // Bonus points for excellent similarity
                } else if (this.similarityScore >= 70) {
                    feedback = `טוב מאוד! דמיון של ${this.similarityScore}% 👍`;
                    feedbackType = 'success';
                    this.score += 15;
                } else if (this.similarityScore >= 50) {
                    feedback = `לא רע! דמיון של ${this.similarityScore}% - נסה שוב 😊`;
                    feedbackType = 'info';
                    this.score += 10;
                } else {
                    feedback = `דמיון של ${this.similarityScore}% - המשך להתרגל 💪`;
                    feedbackType = 'info';
                    this.score += 5;
                }

                this.updateScore();
                this.showFeedback(feedback, feedbackType);

                console.log(`Target: "${targetWord}", Spoken: "${spokenWord}", Similarity: ${this.similarityScore}%`);
            }

            calculateLevenshteinSimilarity(str1, str2) {
                // Normalize strings for comparison
                const s1 = str1.toLowerCase().replace(/[^\u0590-\u05FF]/g, ''); // Keep only Hebrew characters
                const s2 = str2.toLowerCase().replace(/[^\u0590-\u05FF]/g, '');

                if (s1.length === 0) return s2.length === 0 ? 1 : 0;
                if (s2.length === 0) return 0;

                // Create matrix for dynamic programming
                const matrix = Array(s2.length + 1).fill(null).map(() => Array(s1.length + 1).fill(null));

                // Initialize first row and column
                for (let i = 0; i <= s1.length; i++) matrix[0][i] = i;
                for (let j = 0; j <= s2.length; j++) matrix[j][0] = j;

                // Fill matrix
                for (let j = 1; j <= s2.length; j++) {
                    for (let i = 1; i <= s1.length; i++) {
                        const indicator = s1[i - 1] === s2[j - 1] ? 0 : 1;
                        matrix[j][i] = Math.min(
                            matrix[j][i - 1] + 1,     // deletion
                            matrix[j - 1][i] + 1,     // insertion
                            matrix[j - 1][i - 1] + indicator // substitution
                        );
                    }
                }

                // Calculate similarity percentage
                const maxLength = Math.max(s1.length, s2.length);
                const distance = matrix[s2.length][s1.length];
                return (maxLength - distance) / maxLength;
            }

            offerManualInput() {
                if (!this.currentWord) return;

                const userInput = prompt(`זיהוי הדיבור לא עבד. אנא הקלד את המילה "${this.currentWord.word}" כפי שאתה מבטא אותה:`);

                if (userInput && userInput.trim()) {
                    this.recognizedText = userInput.trim();
                    console.log('Manual input received:', this.recognizedText);
                    console.log('Target word:', this.currentWord.word);
                    this.calculateSimilarity();
                } else {
                    this.showFeedback('ניתוח דמיון בוטל', 'info');
                }
            }

            showFeedback(message, type) {
                const feedback = document.getElementById('feedback');
                feedback.textContent = message;
                feedback.className = `feedback ${type}`;
                feedback.style.display = 'block';

                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 3000);
            }

            // Promise-based voice loading
            waitForVoices() {
                return new Promise((resolve) => {
                    let voices = speechSynthesis.getVoices();

                    // If voices are already loaded, resolve immediately
                    if (voices.length > 0) {
                        console.log('Voices already loaded:', voices.length);
                        resolve(voices);
                        return;
                    }

                    // If no voices, wait for them to load
                    console.log('Waiting for voices to load...');

                    let attempts = 0;
                    const maxAttempts = 10;

                    const checkVoices = () => {
                        voices = speechSynthesis.getVoices();
                        attempts++;

                        if (voices.length > 0) {
                            console.log(`Voices loaded after ${attempts} attempts:`, voices.length);
                            resolve(voices);
                        } else if (attempts >= maxAttempts) {
                            console.log('Max attempts reached, resolving with empty voices');
                            resolve(voices);
                        } else {
                            // Try again after a short delay
                            setTimeout(checkVoices, 200);
                        }
                    };

                    // Listen for voice changes
                    const onVoicesChanged = () => {
                        voices = speechSynthesis.getVoices();
                        if (voices.length > 0) {
                            console.log('Voices loaded via onvoiceschanged:', voices.length);
                            speechSynthesis.removeEventListener('voiceschanged', onVoicesChanged);
                            resolve(voices);
                        }
                    };

                    speechSynthesis.addEventListener('voiceschanged', onVoicesChanged);

                    // Start checking
                    checkVoices();

                    // Fallback timeout
                    setTimeout(() => {
                        speechSynthesis.removeEventListener('voiceschanged', onVoicesChanged);
                        console.log('Voice loading timeout, resolving with available voices');
                        const finalVoices = speechSynthesis.getVoices();
                        resolve(finalVoices);
                    }, 15000);
                });
            }

            // Voices will be displayed in static HTML section
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new HebrewLetterGame();
        });
    </script>

</body>

</html>